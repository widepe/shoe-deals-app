<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shoe Beagle--The Running Shoe Deal Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* Make cards able to host an overlay */
    .card {
      position: relative;
    }

    /* Wrap the image so we can pin the badge to it */
    /* Wrap the image so we can pin the badge to it */
    .card-image-wrapper {
      position: relative;
      width: 100%;
    }



    /* Discount badge in corner of image */
    .discount-badge {
      position: absolute;
      top: 0.35rem;
      left: 0.35rem;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 700;
      background: rgba(220, 53, 69, 0.9);
      color: #ffffff;
    }

    /* Price row styling */
    .card-meta .price {
      display: inline-flex;
      align-items: baseline;
    }

    /* Original price with line-through */
    .card-original-price {
      margin-left: 0.35rem;
      font-size: 0.8rem;
      color: #777;
      text-decoration: line-through;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f4ede3ff;
      color: #2d2d2d;
      display: flex;
      justify-content: center;
      padding: 2rem 1rem;
      min-height: 100vh;
    }

    .app {
      width: 100%;
      max-width: 900px;
      display: flex;
      flex-direction: column;
      gap: 0.65rem;
      align-items: center;
      padding-top: 2rem;
    }

    /* Top Navigation */
    .top-nav {
      position: absolute;
      top: 1rem;
      left: 1rem;
      right: 1rem;
      z-index: 100;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .top-nav a {
      color: #214478ff;
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: color 0.2s ease;
      user-select: none;
    }

    .top-nav a:hover {
      color: #1a3661;
      text-decoration: underline;
    }

    .brand {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .brand-logo {
      width: 600px;
      height: auto;
      object-fit: contain;
      margin-bottom: 0.5rem;
      max-width: 100%;
      cursor: pointer;
      transition: opacity 0.2s ease;
    }

    .brand-logo:hover { opacity: 0.9; }

    form {
      display: flex;
      justify-content: center;
      align-items: stretch;
      flex-wrap: wrap;
      gap: 0.75rem;
      width: 100%;
      max-width: 650px;
      margin: 0 auto;
    }

    .input-wrapper {
      position: relative;
      width: 100%;
      max-width: 220px;
      flex: 1 1 200px;
    }

    /* Paw icon inside inputs */
    .paw {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1rem;
      opacity: 0.75;
      pointer-events: none;
      transform-origin: 50% 70%;
    }

    .paw.hidden { display: none; }

    @keyframes pawRock {
      0%   { transform: translateY(-50%) rotate(-10deg); }
      50%  { transform: translateY(-50%) rotate(10deg); }
      100% { transform: translateY(-50%) rotate(-10deg); }
    }

    .paw.rock { animation: pawRock 1.1s ease-in-out infinite; }

    /* Icon rock animations */
    @keyframes iconRock {
      0%   { transform: rotate(-10deg); }
      50%  { transform: rotate(10deg); }
      100% { transform: rotate(-10deg); }
    }

    .search-btn.ready { box-shadow: 0 0 0 3px rgba(33, 68, 120, 0.3); }

    .search-btn.ready .magnify-icon {
      display: inline-block;
      animation: iconRock 1.1s ease-in-out infinite;
      transform-origin: center center;
    }

    .alert-prompt-btn .bell-icon {
      display: inline-block;
      animation: iconRock 1.1s ease-in-out infinite;
      transform-origin: center center;
    }

    .alert-submit-btn.ready .envelope-icon {
      display: inline-block;
      animation: iconRock 1.1s ease-in-out infinite;
      transform-origin: center center;
    }

    input[type="text"],
    input[type="search"],
    input[type="number"],
    input[type="email"],
    input[type="tel"] {
      width: 100%;
      height: 42px;
      padding: 0 2.1rem 0 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid #214478ff;
      background: #fafdf4;
      font-size: 1rem;
      box-sizing: border-box;
      transition: border-color 0.2s ease, background-color 0.2s ease;
      color: #444;
    }

    /* Remove number input arrows */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }

    input::placeholder { color: #999; opacity: 1; }

    .model-inactive { background: #faf5f2ff; cursor: not-allowed; }
    .model-active { background: #ffffff; cursor: text; }

    .suggestions {
      position: absolute;
      top: 46px;
      left: 0;
      right: 0;
      background: #ffffff;
      border: 1px solid #214478ff;
      border-radius: 0.5rem;
      margin-top: 0.15rem;
      max-height: 180px;
      overflow-y: auto;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
      z-index: 10;
      padding: 0.25rem 0;
      display: none;
    }

    .suggestion-item {
      padding: 0.25rem 0.75rem;
      text-align: left;
      font-size: 0.9rem;
      cursor: pointer;
    }
    .suggestion-item:hover { background: #e8f0ff; }

    button {
      border: none;
      border-radius: 0.75rem;
      background: #214478ff;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s ease, box-shadow 0.2s ease;
    }

    .button-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 0 0 auto;
    }

    .search-btn {
      height: 42px;
      border-radius: 0.5rem;
      border: 1px solid #214478ff;
      background: #214478ff;
      padding: 0 0.75rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      outline: none;
    }
    .search-btn:hover { background: #1a3661; }

    /* Tagline must ALWAYS remain under inputs */
    .tagline {
      font-size: 0.95rem;
      color: #2d3c22;
      margin-top: 0.05rem;
      text-align: center;
      width: 100%;
    }

    /* Separate dynamic status line so tagline never gets overwritten */
    .status-message {
      font-size: 0.9rem;
      color: #2d3c22;
      margin-top: 0.15rem;
      text-align: center;
      width: 100%;
      min-height: 1.1rem;
    }

    /* Daily Deals Section */
    .daily-deals {
      width: 100%;
      max-width: 850px;
      margin-top: 1.0rem;
    }

    .daily-deals-header {
      font-size: 1.8rem;
      font-weight: 700;
      color: #214478ff;
      margin-bottom: 1rem;
      text-align: center;
    }

    .daily-deals-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 200px));      gap: 1rem;
      width: 100%;
      justify-content: center;
    }

    /* Unified card style: search + daily deals */
    .card {
      background: #d9e1ebff;
      border: 2px solid #214478ff;
      border-radius: 0.75rem;
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      text-align: left;
      box-sizing: border-box;
    }

    .card-link {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      text-decoration: none;
      color: inherit;
      height: 100%;
    }
    .card img {
      width: 100%;
      border-radius: 0.6rem;
      object-fit: contain;
      height: 150px;
      background: white;
      border: 1px solid #214478ff;
      box-sizing: border-box;
    }


.card-title {
  font-size: 0.92rem;
  font-weight: 600;
  display: -webkit-box;
  -webkit-line-clamp: 4;    /* allow up to 4 lines */
  -webkit-box-orient: vertical;
  overflow: hidden;         /* hide extra text */
  text-overflow: ellipsis;  /* optional ... */
  min-height: calc(1.2em * 4);  /* reserve room for 4 lines */
}

    /*
    .card-title {
      font-size: 0.92rem;
      font-weight: 600;
    }
*/
    .card-store {
      font-size: 0.82rem;
      color: #49543a;
    }

    .card-price-row {
      display: flex;
      align-items: baseline;
      gap: 0.3rem;
      font-size: 0.95rem;
    }

    .price {
      font-weight: 700;
      color: #214478ff;
    }

    .card-original {
      text-decoration: line-through;
      font-size: 0.8rem;
      color: #777;
    }

    .card-discount {
      font-size: 0.8rem;
      color: #2d3c22;
      margin-top: 0.05rem;
    }

    .results {
      margin-top: 1.0rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 200px));
      gap: 1.25rem;
      width: 100%;
      justify-content: center;
      max-width: 850px;
    }

    .disclaimer {
      font-size: 0.8rem;
      color: #555;
      max-width: 850px;
      margin: 0.15rem auto 0;
      text-align: center;
    }

    /* About Section */
    .about-section {
      width: 100%;
      max-width: 850px;
      background: #ffffffc9;
      border: 2px solid #214478ff;
      border-radius: 0.75rem;
      padding: 1.25rem 2rem 0.9rem;
      margin-top: 1.0rem;
      line-height: 1.7;
      box-sizing: border-box;
    }

    .about-section h2 {
      color: #214478ff;
      font-size: 1.8rem;
      margin: 0 0 0.85rem;
      text-align: center;
    }

    .about-section p {
      margin-bottom: 1rem;
      font-size: 1rem;
      color: #2d2d2d;
    }

    /* Alert section styles */
    .alert-wrapper {
      width: 100%;
      max-width: 850px;
      margin-top: 1.0rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }

    .alert-prompt-btn,
    .alert-form,
    .alert-confirmation,
    .alert-existing-info {
      margin-left: auto;
      margin-right: auto;
    }

    .alert-prompt-btn {
      display: block;
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      background: #214478ff;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      border: 1px solid #214478ff;
      transition: background 0.2s ease;
    }
    .alert-prompt-btn:hover { background: #1a3661; }

    .alert-form {
      width: 100%;
      max-width: 600px;
      padding: 1.25rem;
      border-radius: 0.75rem;
      background: #ffffffc9;
      border: 2px solid #214478ff;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      align-items: center;
      box-sizing: border-box;
    }

    .alert-product-message {
      font-size: 0.95rem;
      color: #2d3c22;
      text-align: center;
      font-weight: 500;
      width: 100%;
    }
    .alert-product-message strong { color: #214478ff; font-weight: 700; }

    .alert-form-row {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      width: 66%;
      max-width: 350px;
    }

    .alert-form-row label {
      font-size: 0.9rem;
      font-weight: 600;
      color: #2d3c22;
      text-align: left;
    }

    .alert-form-row input {
      width: 100%;
      padding: 0.6rem 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid #214478ff;
      background: #fafdf4;
      font-size: 0.95rem;
      box-sizing: border-box;
      color: #444;
    }

    .price-input-wrapper {
      position: relative;
      width: 100%;
    }
    .price-input-wrapper::before {
      content: '$';
      position: absolute;
      left: 0.75rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.95rem;
      color: #444;
      pointer-events: none;
      font-weight: 500;
    }
    .price-input-wrapper input {
      padding-left: 1.75rem;
      padding-right: 2.1rem;
    }

    .alert-privacy-note {
      font-size: 0.8rem;
      color: #34452a;
      text-align: center;
      padding: 0.5rem;
      background: transparent;
      border-radius: 0.5rem;
      width: 100%;
    }

    .alert-duration-note {
      font-size: 0.85rem;
      color: #34452a;
      text-align: center;
      font-style: italic;
      width: 100%;
    }

    .alert-submit-btn {
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      background: #214478ff;
      color: white;
      font-size: 1rem;
      cursor: pointer;
      border: 1px solid #214478ff;
      transition: background 0.2s ease, box-shadow 0.2s ease;
      width: auto;
      align-self: center;
      display: none;
      margin-left: auto;
      margin-right: auto;
    }

    .alert-submit-btn.ready {
      display: block;
      box-shadow: 0 0 0 3px rgba(33, 68, 120, 0.3);
    }
    .alert-submit-btn.ready:hover { background: #1a3661; }

    .alert-confirmation,
    .alert-existing-info {
      width: 100%;
      max-width: 600px;
      padding: 1.25rem;
      border-radius: 0.75rem;
      background: #ffffffc9;
      border: 2px solid #214478ff;
      color: #2d3c22;
      text-align: center;
      font-size: 0.95rem;
      line-height: 1.6;
      box-sizing: border-box;
    }
    .alert-confirmation strong,
    .alert-existing-info strong { color: #214478ff; }

    /* My Alerts dashboard */
    .alerts-dashboard {
      width: 100%;
      max-width: 850px;
      background: #ffffffc9;
      border: 2px solid #214478ff;
      border-radius: 0.75rem;
      padding: 1.25rem 1.25rem 1.5rem;
      margin-top: 1.0rem;
      box-sizing: border-box;
    }

    .alerts-title {
      color: #214478ff;
      font-size: 1.6rem;
      font-weight: 800;
      text-align: center;
      margin: 0.25rem 0 0.3rem;
    }

    .alerts-instruction {
      color: #49543a;
      font-size: 0.88rem;
      text-align: center;
      margin: 0 0 0.6rem;
      font-style: italic;
    }

    .alerts-table-wrapper {
      width: 100%;
      overflow-x: auto;
    }

    .alerts-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
    }

    .alerts-table colgroup col:nth-child(1) { width: 12%; }  /* Date Set */
    .alerts-table colgroup col:nth-child(2) { width: 45%; }  /* Shoe */
    .alerts-table colgroup col:nth-child(3) { width: 7%; }   /* Days Left - HALF */
    .alerts-table colgroup col:nth-child(4) { width: 10%; }  /* Target */
    .alerts-table colgroup col:nth-child(5) { width: 19%; }  /* Status */

    .alerts-table thead th {
      text-align: left;
      font-size: 0.78rem;
      letter-spacing: 0.02em;
      text-transform: uppercase;
      color: #214478ff;
      padding: 0.5rem 0.65rem;
      border-bottom: 2px solid rgba(33, 68, 120, 0.35);
      background: rgba(255, 255, 255, 0.55);
    }

    .alerts-table tbody tr {
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .alerts-table tbody tr:hover {
      background: rgba(33, 68, 120, 0.08);
    }

    .alerts-table tbody tr.selected {
      background: rgba(33, 68, 120, 0.15);
    }

    .alerts-table tbody tr.inactive {
      background: #e8e8e8;
    }

    .alerts-table tbody tr.inactive:hover {
      background: #d8d8d8;
    }

    .alerts-table tbody td {
      padding: 0.5rem 0.65rem;
      border-bottom: 1px solid rgba(33, 68, 120, 0.18);
      vertical-align: middle;
      font-size: 0.92rem;
      color: #2d2d2d;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      line-height: 1.3;
    }

    .alerts-table tbody td:nth-child(2) {
      max-width: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .alerts-table td.target-cell {
      text-align: right;
    }

    .alerts-muted {
      text-align: center;
      padding: 1.25rem 0.5rem;
      color: #49543a;
      font-size: 0.95rem;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.25rem 0.55rem;
      border-radius: 999px;
      font-weight: 700;
      font-size: 0.82rem;
      border: 1px solid rgba(33, 68, 120, 0.25);
      background: rgba(255, 255, 255, 0.6);
      color: #214478ff;
    }

    .pill.active {
      background: rgba(46, 160, 67, 0.20);
      border-color: rgba(46, 160, 67, 0.55);
      color: #1f6a2a;
    }

    .pill.expired {
      background: rgba(150, 150, 150, 0.18);
      border-color: rgba(150, 150, 150, 0.40);
      color: #555;
    }

    .pill.cancelled {
      background: rgba(220, 53, 69, 0.14);
      border-color: rgba(220, 53, 69, 0.35);
      color: #8a1f2c;
    }

    /* Alert action panel */
    .alert-actions {
      padding: 0.75rem 1rem;
      background: rgba(33, 68, 120, 0.05);
      border-left: 3px solid #214478ff;
      margin: 0;
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      align-items: center;
    }

    .alert-actions button {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      font-size: 0.88rem;
      font-weight: 600;
      border: 1px solid #214478ff;
      background: #214478ff;
      color: white;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .alert-actions button:hover {
      background: #1a3661;
    }

    .alert-actions button.secondary {
      background: white;
      color: #214478ff;
      border: 1px solid #214478ff;
    }

    .alert-actions button.secondary:hover {
      background: rgba(33, 68, 120, 0.1);
    }

    .alert-actions button.danger {
      background: #dc3545;
      border-color: #c82333;
    }

    .alert-actions button.danger:hover {
      background: #c82333;
    }

    .alert-actions button.success {
      background: #28a745;
      border-color: #218838;
    }

    .alert-actions button.success:hover {
      background: #218838;
    }

    .alert-actions .confirmation {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .alert-actions .confirmation-text {
      font-size: 0.88rem;
      color: #2d2d2d;
      font-weight: 600;
    }

    .alert-actions .edit-price-label {
      font-size: 0.88rem;
      color: #2d2d2d;
      font-weight: 600;
    }

    /* Price change input in action panel */
    .price-change-wrapper {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .price-change-input {
      position: relative;
      display: inline-block;
    }

    .price-change-input::before {
      content: '$';
      position: absolute;
      left: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.9rem;
      color: #444;
      pointer-events: none;
      font-weight: 500;
    }

    .price-change-input input {
      width: 80px;
      height: 32px;
      padding: 0 0.3rem 0 1.5rem;
      border-radius: 0.5rem;
      border: 1px solid #214478ff;
      background: #fafdf4;
      font-size: 0.9rem;
      text-align: right;
    }

    .clear-inactive-wrapper {
      width: 100%;
      display: flex;
      justify-content: center;
      margin-top: 1rem;
    }

    .clear-inactive-actions {
      padding: 0.75rem 1rem;
      background: rgba(220, 53, 69, 0.08);
      border: 1px solid #dc3545;
      border-radius: 0.5rem;
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }

    .clear-inactive-btn {
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
      background: #dc3545;
      border: 1px solid #c82333;
      color: white;
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
    }

    .clear-inactive-btn:hover {
      background: #c82333;
    }

    .hidden { display: none !important; }

    /* Footer */
    .footer {
      margin-top: 2rem;
      padding: 0.75rem 1rem;
      background: rgba(244, 237, 227, 0.97);
      border-top: 1px solid rgba(0, 0, 0, 0.08);
      font-size: 0.82rem;
      color: #444;
      text-align: center;
    }

    .footer a {
      color: #214478ff;
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
      margin: 0 0.25rem;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    /* Modal styles for Privacy & Terms */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
      padding: 1rem;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: #ffffff;
      border-radius: 0.75rem;
      max-width: 720px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.25);
      padding: 1.5rem 2rem 1.75rem;
      box-sizing: border-box;
    }

    .modal-header {
      text-align: center;
      margin-bottom: 1rem;
    }

    .modal-header img {
      width: 140px;
      height: auto;
      display: block;
      margin: 0 auto 0.5rem;
    }

    .modal-header h2 {
      margin: 0;
      font-size: 1.4rem;
      color: #214478ff;
    }

    .modal-body {
      font-size: 0.9rem;
      line-height: 1.6;
      color: #333;
    }

    .modal-body h3 {
      font-size: 1rem;
      margin-top: 0.9rem;
      margin-bottom: 0.3rem;
      color: #214478ff;
    }

    .modal-body p {
      margin: 0.25rem 0 0.4rem;
    }

    .modal-close-row {
      text-align: center;
      margin-top: 1rem;
    }

    .modal-close-btn {
      padding: 0.5rem 1.25rem;
      border-radius: 999px;
      border: 1px solid #214478ff;
      background: #214478ff;
      color: #fff;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .modal-close-btn:hover {
      background: #1a3661;
    }
  </style>
</head>

<body>
  <div style="display:none;">Impact-Site-Verification: 484b0fd5-0544-4654-b916-4e921a2e5077</div>

  <div class="top-nav">
    <a id="myAlertsLink">My Alerts</a>
  </div>

  <div class="app">
    <div class="brand">
      <img src="/images/logo.svg" class="brand-logo" alt="Shoe Beagle Logo" id="logoLink">
    </div>

  <form id="search-form" method="POST">
  <div class="input-wrapper">
        <input id="brand" type="text" placeholder="Enter Shoe Brand" autocomplete="off" required />
        <span class="paw rock" id="brandPaw">üêæ</span>
        <div id="brandSuggestions" class="suggestions"></div>
      </div>

      <div class="input-wrapper">
        <input id="model" type="text" placeholder="" autocomplete="off" required class="model-inactive" disabled />
        <span class="paw hidden" id="modelPaw">üêæ</span>
        <div id="modelSuggestions" class="suggestions"></div>
      </div>

      <div class="button-wrapper">
        <button id="fetchBtn" type="submit" class="search-btn"><span class="magnify-icon">üîç</span> Fetch!</button>
      </div>
    </form>

    <div class="tagline">Let's find your running shoes!</div>
    <div class="status-message" id="statusMessage"></div>

    <div id="mainContent">

      <div class="daily-deals" id="dailyDeals">
        <div class="daily-deals-header">Marty's Daily Deals</div>
        <div class="daily-deals-grid" id="dailyDealsGrid"></div>
      </div>

      <div class="results" id="results"></div>
      <p class="disclaimer">Shoe Beagle does not sell products directly and is not responsible for changes in price, availability, or shipping terms on retailer sites.</p>

      <div class="alert-wrapper" id="alertWrapper" style="display:none;">
        <button class="alert-prompt-btn" id="alertPromptBtn"><span class="bell-icon">üîî</span> Set Price Alert?</button>

        <div class="alert-existing-info" id="alertExistingInfo" style="display:none;"></div>

        <div class="alert-form" id="alertForm" style="display:none;">
          <div class="alert-product-message">
            Alert me when <strong id="alertProductName"></strong> is less than:
          </div>

          <div class="alert-form-row">
            <div class="price-input-wrapper">
              <input id="alertPrice" type="number" step="1" placeholder="Enter Dollar Amount" min="1">
              <span class="paw rock" id="alertPricePaw">üêæ</span>
            </div>
          </div>

          <div class="alert-form-row">
            <label for="alertContact">Email Address</label>
            <input id="alertContact" type="text" placeholder="you@example.com">
          </div>

          <div class="alert-privacy-note">üîí Your information is used only to send you requested price alerts, and is never sold or shared with third parties.</div>

          <button class="alert-submit-btn" id="alertSubmitBtn">
            <span class="envelope-icon">üì©</span> Set Price Alert
          </button>

          <div class="alert-duration-note">Your price alert will remain active for 30 days, or until you cancel.</div>
        </div>

        <div class="alert-confirmation" id="alertConfirmation" style="display:none;"></div>
      </div>
    </div>

  <!-- About Us Modal -->
  <div id="aboutModal" class="modal-overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
      <div class="modal-header">
<img src="/images/logo.svg" alt="Shoe Beagle Logo" style="width: 300px;">
        <h2 id="aboutTitle">About Us</h2>
      </div>
      <div class="modal-body">
        <p>Shoe Beagle is a price comparison website dedicated to helping runners find the best deals on running shoes. We provide side-by-side price comparisons across multiple retailers, allowing users to search by brand and model to find the lowest prices.</p>
        <p>Our platform features price alerts, real-time deal updates, and direct links to merchant sites where users can complete their purchases.</p>
        <p>We do our best to sniff out the best running shoe deals for you!</p>
        <div style="text-align: center; margin: 1.2rem 0 0.35rem;">
          <img src="/images/marty.svg" alt="Marty the Beagle" style="width: 200px; height: auto;">
        </div>
        <p><strong>Affiliate Disclosure:</strong> Some of the links on Shoe Beagle are affiliate links. This means Shoe Beagle may earn a small commission if you click a link and make a purchase, at no extra cost to you.</p>
      </div>
      <div class="modal-close-row">
        <button type="button" class="modal-close-btn" data-close="aboutModal">Close</button>
      </div>
    </div>
  </div>
    <div id="alertsDashboard" class="alerts-dashboard hidden">
      <div class="alerts-title">My Alerts</div>
      <div class="alerts-instruction">Tap or Click Row to Manage Alert</div>
      <!-- NEW: stats summary line -->

      <div class="alerts-table-wrapper">
        <table class="alerts-table" aria-label="My Alerts Table" id="alertsTable">
          <colgroup>
            <col style="width: 12%;">  <!-- Date Set -->
            <col style="width: 45%;">  <!-- Shoe -->
            <col style="width: 7%;">   <!-- Days Left - HALF -->
            <col style="width: 10%;">  <!-- Target -->
            <col style="width: 19%;">  <!-- Status -->
          </colgroup>
          <thead>
            <tr>
              <th>Date Set</th>
              <th>Shoe</th>
              <th>Days Left</th>
              <th>Target</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="alertsTbody"></tbody>
        </table>
      </div>

      <div id="alertsEmpty" class="alerts-muted hidden">No alerts have been set.</div>

      <div class="clear-inactive-wrapper hidden" id="clearInactiveWrapper"></div>
    </div>

    <!-- Footer -->
    <div class="footer">

        <a href="/pages/about.html">About</a> |
        <a href="/pages/contact.html">Contact</a> |
        <a href="/pages/privacy.html">Privacy</a> |
        <a href="/pages/terms.html">Terms</a> |
        <br>
        ¬© <span id="footerYear"></span> Shoe Beagle. All rights reserved.    </div>
  </div>

  <!-- Privacy Policy Modal -->
  <div id="privacyModal" class="modal-overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="privacyTitle">
      <div class="modal-header">
        <img src="/images/logo.svg" alt="Shoe Beagle Logo" style="width: 300px;">
        <h2 id="privacyTitle">Privacy Policy</h2>
      </div>
      <div class="modal-body">
        <p>Last Updated: January 6, 2026</p>

        <h3>1. Who we are</h3>
        <p>Shoe Beagle is a website that helps runners discover and compare prices on running shoes from multiple online retailers.</p>

        <h3>2. What information we collect</h3>
        <p>We collect only the information we need to operate the the site and provide price alerts:</p>
        <ul>
          <li><strong>Search information:</strong> brands and models you search for.</li>
          <li><strong>Alert information:</strong> the shoe you choose, your target price, and the email address or phone number you provide for that alert.</li>
          <li><strong>Basic usage data:</strong> standard log data such as browser type, approximate location, and pages visited, typically collected via analytics tools or server logs.</li>
        </ul>

        <h3>3. How we use your information</h3>
        <p>We use your information to:</p>
        <ul>
          <li>Process your shoe searches and show you deals.</li>
          <li>Send you price alerts that you have requested.</li>
          <li>Monitor and improve the performance and reliability of Shoe Beagle.</li>
        </ul>

        <h3>4. Price alerts and communications</h3>
        <p>When you set a price alert, we use your email address or phone number only to send you alert-related messages (for example, when a deal meets your target price). We do not sell your contact details to third parties for their own marketing.</p>

        <h3>5. Cookies and similar technologies</h3>
        <p>Like most websites, Shoe Beagle may use cookies or similar technologies to remember your preferences and understand how visitors use the site. You can usually control cookies through your browser settings.</p>

        <h3>6. Third-party services and links</h3>
        <p>Our site links to third-party websites (for example, online retailers that sell shoes). When you click a link and leave Shoe Beagle, this Privacy Policy no longer applies and the third party's own policies will govern their use of your information.</p>
        <p>Some of the links on Shoe Beagle are affiliate links. This means we may earn a small commission if you click a link and make a purchase, at no extra cost to you.</p>

        <h3>7. Data security</h3>
        <p>We use reasonable technical and organizational measures to help protect the information we collect. However, no website or internet transmission is ever completely secure, and we cannot guarantee absolute security.</p>

        <h3>8. Data retention</h3>
        <p>We retain alert-related contact information as long as needed to provide your alerts or as required by law. You can request deletion of your alert-related information at any time by contacting us.</p>

        <h3>9. Your choices and rights</h3>
        <p>You may:</p>
        <ul>
          <li>Stop using the site at any time.</li>
          <li>Cancel or adjust your alerts in the "My Alerts" area.</li>
          <li>Request that we delete your alert-related information by contacting us.</li>
        </ul>

        <h3>10. Contact us</h3>
        <p>Contact us if you have questions about this Privacy Policy or how we handle your data.</p>
      </div>
      <div class="modal-close-row">
        <button type="button" class="modal-close-btn" data-close="privacyModal">Close</button>
      </div>
    </div>
  </div>

  <!-- Terms of Use Modal -->
  <div id="termsModal" class="modal-overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="termsTitle">
      <div class="modal-header">
        <img src="/images/logo.svg" alt="Shoe Beagle Logo" style="width: 300px;">
        <h2 id="termsTitle">Terms of Use</h2>
      </div>
      <div class="modal-body">
        <p>Last Updated: January 6, 2026</p>

        <h3>1. Acceptance of these terms</h3>
        <p>By accessing or using Shoe Beagle, you agree to these Terms of Use. If you do not agree, please do not use the site.</p>

        <h3>2. What Shoe Beagle does</h3>
        <p>Shoe Beagle helps you discover and compare prices on running shoes from third-party retailers. We do not sell products directly, handle payments, or fulfill orders. When you click a link to a retailer, you leave our site and complete your purchase (if any) on the retailer's website.</p>
        <p>Some links to retailers on Shoe Beagle may be affiliate links, which means we may earn a small commission if you make a purchase through those links, at no extra cost to you.</p>

        <h3>3. No guarantees on prices or availability</h3>
        <p>We do our best to show accurate and timely deal information, but prices, discounts, and availability can change quickly. We cannot guarantee that any price or offer listed on Shoe Beagle will still be available when you click through to a retailer.</p>

        <h3>4. Your responsibilities</h3>
        <p>You are responsible for:</p>
        <ul>
          <li>Reviewing the final price, shipping, taxes, and terms on the retailer's website before you complete any purchase.</li>
          <li>Using Shoe Beagle in compliance with applicable laws and these Terms of Use.</li>
        </ul>

        <h3>5. Price alerts</h3>
        <p>When you set a price alert, you agree to receive alert-related messages using the contact details you provide. You can manage or cancel your alerts from the "My Alerts" section of the site. Alerts are provided as a convenience only and we do not guarantee that every qualifying deal will trigger or reach you.</p>

        <h3>6. Intellectual property</h3>
        <p>The Shoe Beagle name, logo, and overall site design, along with the underlying software and content we create, are owned by us or our licensors and protected by copyright and other laws. You may not copy, modify, or redistribute the site or its content except as allowed by law or with our written permission.</p>

        <h3>7. Third-party sites and services</h3>
        <p>Any websites or services we link to are operated by third parties, not by Shoe Beagle. We are not responsible for the content, policies, or practices of any third-party website or service, and your use of those sites is at your own risk.</p>

        <h3>8. Disclaimer of warranties</h3>
        <p>Shoe Beagle is provided "as is" and "as available." To the fullest extent permitted by law, we disclaim all warranties, express or implied, including but not limited to implied warranties of merchantability, fitness for a particular purpose, and non-infringement.</p>

        <h3>9. Limitation of liability</h3>
        <p>To the fullest extent permitted by law, Shoe Beagle and its owners will not be liable for any indirect, incidental, special, consequential, or punitive damages arising out of or related to your use of the site, even if we have been advised of the possibility of such damages.</p>

        <h3>10. Changes to these terms</h3>
        <p>We may update these Terms of Use from time to time. The "Last Updated" date at the top will tell you when we last made changes. Your continued use of the site after changes are posted means you accept the updated terms.</p>

        <h3>11. Contact us</h3>
        <p>Contact us if you have questions about these Terms of Use.</p>
      </div>
      <div class="modal-close-row">
        <button type="button" class="modal-close-btn" data-close="termsModal">Close</button>
      </div>
    </div>
  </div>
<!-- Contact Modal -->
<div id="contactModal" class="modal-overlay">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="contactTitle">
    <div class="modal-header">
      <img src="/images/logo.svg" alt="Shoe Beagle Logo" style="width: 300px;">
      <h2 id="contactTitle">Contact Us</h2>
    </div>
    <div class="modal-body">
      <p>Have a question, suggestion, or issue? We'd love to hear from you!</p>
      
      <form id="contactForm" style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;">
        <div>
          <label for="contactName" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #214478ff;">Your Name</label>
          <input 
            type="text" 
            id="contactName" 
            required 
            style="width: 100%; padding: 0.6rem; border: 1px solid #214478ff; border-radius: 0.5rem; font-size: 0.95rem;"
          />
        </div>
        
        <div>
          <label for="contactEmail" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #214478ff;">Your Email</label>
          <input 
            type="email" 
            id="contactEmail" 
            required 
            style="width: 100%; padding: 0.6rem; border: 1px solid #214478ff; border-radius: 0.5rem; font-size: 0.95rem;"
          />
        </div>
        
        <div>
          <label for="contactMessage" style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #214478ff;">Message</label>
          <textarea 
            id="contactMessage" 
            required 
            rows="5"
            style="width: 100%; padding: 0.6rem; border: 1px solid #214478ff; border-radius: 0.5rem; font-size: 0.95rem; resize: vertical; font-family: inherit;"
          ></textarea>
        </div>
        
        <div id="contactStatus" style="display: none; padding: 0.75rem; border-radius: 0.5rem; text-align: center;"></div>
        
        <button 
          type="submit" 
          id="contactSubmitBtn"
          style="padding: 0.75rem 1.5rem; background: #214478ff; color: white; border: none; border-radius: 0.5rem; font-size: 1rem; cursor: pointer; font-weight: 600;"
        >
          Send Message
        </button>
      </form>
    </div>
    <div class="modal-close-row">
      <button type="button" class="modal-close-btn" data-close="contactModal">Close</button>
    </div>
  </div>
</div>  
  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
    const form = document.getElementById("search-form");
    const statusMessageEl = document.getElementById("statusMessage");
    const resultsEl = document.getElementById("results");
    const dailyDeals = document.getElementById("dailyDeals");
    const dailyDealsGrid = document.getElementById("dailyDealsGrid");

    const alertWrapper = document.getElementById("alertWrapper");
    const alertPromptBtn = document.getElementById("alertPromptBtn");
    const alertForm = document.getElementById("alertForm");
    const alertSubmitBtn = document.getElementById("alertSubmitBtn");
    const alertConfirmation = document.getElementById("alertConfirmation");
    const alertExistingInfo = document.getElementById("alertExistingInfo");
    const alertProductName = document.getElementById("alertProductName");

    const alertPriceInput = document.getElementById("alertPrice");
    const alertPricePaw = document.getElementById("alertPricePaw");
    const alertContactInput = document.getElementById("alertContact");

    const fetchBtn = document.getElementById("fetchBtn");

    const brandInput = document.getElementById("brand");
    const modelInput = document.getElementById("model");
    const brandSuggestions = document.getElementById("brandSuggestions");
    const modelSuggestions = document.getElementById("modelSuggestions");

    const brandPaw = document.getElementById("brandPaw");
    const modelPaw = document.getElementById("modelPaw");

    const mainContent = document.getElementById("mainContent");
    const alertsDashboard = document.getElementById("alertsDashboard");

    const aboutLink = document.getElementById("aboutLink");
    const aboutModal = document.getElementById("aboutModal");
    const myAlertsLink = document.getElementById("myAlertsLink");
    const logoLink = document.getElementById("logoLink");

    const alertsTbody = document.getElementById("alertsTbody");
    const alertsEmpty = document.getElementById("alertsEmpty");
    const alertsTable = document.getElementById("alertsTable");
    const clearInactiveWrapper = document.getElementById("clearInactiveWrapper");

    const footerYear = document.getElementById("footerYear");
    const privacyLink = document.getElementById("privacyLink");
    const termsLink = document.getElementById("termsLink");
    const privacyModal = document.getElementById("privacyModal");
    const termsModal = document.getElementById("termsModal");
    const contactLink = document.getElementById("contactLink");
    const contactModal = document.getElementById("contactModal");
    const contactForm = document.getElementById("contactForm");
    const contactStatus = document.getElementById("contactStatus");
    
    let currentSearch = { brand: "", model: "" };
    let brandSelected = false;
    let selectedAlertRow = null;

    const ALERTS_KEY = "shoeBeagleAlerts";
    let alertsMemoryFallback = [];

    // Set footer year
    if (footerYear) {
      footerYear.textContent = new Date().getFullYear();
    }

    function openModal(el) {
      el.classList.add("active");
      document.body.style.overflow = "hidden";
    }

    function closeModal(el) {
      el.classList.remove("active");
      document.body.style.overflow = "";
    }

if (aboutLink && aboutModal) {
  aboutLink.addEventListener("click", () => openModal(aboutModal));
}

if (privacyLink && privacyModal) {
  privacyLink.addEventListener("click", () => openModal(privacyModal));
}

if (termsLink && termsModal) {
  termsLink.addEventListener("click", () => openModal(termsModal));
}
if (contactLink && contactModal) {
  contactLink.addEventListener("click", () => openModal(contactModal));
}    document.querySelectorAll(".modal-close-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const targetId = btn.getAttribute("data-close");
        const overlay = document.getElementById(targetId);
        if (overlay) closeModal(overlay);
      });
    });

    document.querySelectorAll(".modal-overlay").forEach(overlay => {
      overlay.addEventListener("click", (e) => {
        if (e.target === overlay) {
          closeModal(overlay);
        }
      });
    });

    function canUseLocalStorage() {
      try {
        const k = "__sb_test__";
        localStorage.setItem(k, "1");
        localStorage.removeItem(k);
        return true;
      } catch (e) { return false; }
    }

    function loadAlerts() {
      if (canUseLocalStorage()) {
        try {
          const raw = localStorage.getItem(ALERTS_KEY);
          const parsed = raw ? JSON.parse(raw) : [];
          return Array.isArray(parsed) ? parsed : [];
        } catch (e) { return []; }
      }
      return alertsMemoryFallback;
    }

    function saveAlerts(list) {
      if (canUseLocalStorage()) {
        try { localStorage.setItem(ALERTS_KEY, JSON.stringify(list)); } catch (e) {}
      } else {
        alertsMemoryFallback = list;
      }
    }

    function normalizeStr(s) { return String(s || "").trim().toLowerCase(); }
    function nowMs() { return Date.now(); }

    // Shared discount helper used by cards
    function getDiscountInfo(item) {
      const price = Number(item.price);
      const original = item.originalPrice != null ? Number(item.originalPrice) : NaN;

      // Best case: we have both prices
      if (
        Number.isFinite(price) &&
        Number.isFinite(original) &&
        original > 0 &&
        price < original
      ) {
        const pct = Math.round(((original - price) / original) * 100);
        return {
          hasDiscount: true,
          current: price.toFixed(2),
          original: original.toFixed(2),
          percent: pct
        };
      }

      // Fallback: parse string discount like "-23%"
      if (Number.isFinite(price) && typeof item.discount === "string" && item.discount.includes("%")) {
        const m = item.discount.match(/(-?\d+(?:\.\d+)?)%/);
        if (m) {
          const pct = Math.abs(Number(m[1]));
          if (Number.isFinite(pct) && pct > 0 && pct < 100) {
            const origGuess = price / (1 - pct / 100);
            if (Number.isFinite(origGuess) && origGuess > price) {
              return {
                hasDiscount: true,
                current: price.toFixed(2),
                original: origGuess.toFixed(2),
                percent: Math.round(pct)
              };
            }
          }
        }
      }

      return { hasDiscount: false };
    }

    function daysBetween(msA, msB) {
      const diff = Math.abs(msA - msB);
      return Math.floor(diff / (1000 * 60 * 60 * 24));
    }

    function formatDateShort(ms) {
      const d = new Date(ms);
      const day = d.getDate();
      const months = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
      const mon = months[d.getMonth()];
      const yy = String(d.getFullYear()).slice(-2);
      return `${day}-${mon}-${yy}`;
    }

    function computeAlertStatus(alert) {
      if (alert.cancelledAt) return "Cancelled";
      const ageDays = daysBetween(alert.setAt, nowMs());
      if (ageDays >= 30) return "Expired";
      return "Active";
    }

    function computeDaysLeft(alert) {
      if (alert.cancelledAt) return 0;
      const ageDays = daysBetween(alert.setAt, nowMs());
      const left = 30 - ageDays;
      return left > 0 ? left : 0;
    }

    function alertKey(brand, model) {
      return `${normalizeStr(brand)}::${normalizeStr(model)}`;
    }

    function findActiveAlertFor(brand, model) {
      const key = alertKey(brand, model);
      const list = loadAlerts();
      return list.find(a => a.key === key && computeAlertStatus(a) === "Active");
    }

    function upsertAlert(newAlert) {
      const list = loadAlerts();
      const idx = list.findIndex(a => a.id === newAlert.id);
      if (idx >= 0) list[idx] = newAlert;
      else list.push(newAlert);
      saveAlerts(list);
    }

    function deleteAlert(alertId) {
      const list = loadAlerts();
      const filtered = list.filter(a => a.id !== alertId);
      saveAlerts(filtered);
    }

    function pillClassFor(status) {
      if (status === "Active") return "pill active";
      if (status === "Expired") return "pill expired";
      if (status === "Cancelled") return "pill cancelled";
      return "pill";
    }

    function clearAllInactive() {
      const list = loadAlerts();
      const active = list.filter(a => {
        const status = computeAlertStatus(a);
        return status === "Active";
      });
      saveAlerts(active);
      renderAlertsDashboard();
    }

    function showConfirmation(actionsDiv, message, onYes) {
      actionsDiv.innerHTML = "";

      const confirmDiv = document.createElement("div");
      confirmDiv.className = "confirmation";

      const confirmText = document.createElement("span");
      confirmText.className = "confirmation-text";
      confirmText.textContent = message;

      const yesBtn = document.createElement("button");
      yesBtn.textContent = "Yes";
      yesBtn.className = "success";
      yesBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        onYes();
      });

      const noBtn = document.createElement("button");
      noBtn.textContent = "No";
      noBtn.className = "secondary";
      noBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        renderAlertsDashboard();
      });

      confirmDiv.appendChild(confirmText);
      confirmDiv.appendChild(yesBtn);
      confirmDiv.appendChild(noBtn);
      actionsDiv.appendChild(confirmDiv);
    }

    function showClearInactiveConfirmation() {
      clearInactiveWrapper.innerHTML = "";

      const actionsDiv = document.createElement("div");
      actionsDiv.className = "clear-inactive-actions";

      const confirmText = document.createElement("span");
      confirmText.className = "confirmation-text";
      confirmText.textContent = "Clear all inactive alerts?";

      const yesBtn = document.createElement("button");
      yesBtn.textContent = "Yes";
      yesBtn.className = "success";
      yesBtn.addEventListener("click", () => {
        clearAllInactive();
      });

      const noBtn = document.createElement("button");
      noBtn.textContent = "No";
      noBtn.className = "secondary";
      noBtn.addEventListener("click", () => {
        renderAlertsDashboard();
      });

      actionsDiv.appendChild(confirmText);
      actionsDiv.appendChild(yesBtn);
      actionsDiv.appendChild(noBtn);
      clearInactiveWrapper.appendChild(actionsDiv);
    }



    function renderAlertsDashboard() {
      const list = loadAlerts();
      alertsTbody.innerHTML = "";
      selectedAlertRow = null;
      clearInactiveWrapper.innerHTML = "";

      if (!list.length) {
        alertsEmpty.classList.remove("hidden");
        alertsTable.classList.add("hidden");
        clearInactiveWrapper.classList.add("hidden");
        return;
      }

      alertsEmpty.classList.add("hidden");
      alertsTable.classList.remove("hidden");

      const hasInactive = list.some(a => {
        const status = computeAlertStatus(a);
        return status === "Expired" || status === "Cancelled";
      });

      if (hasInactive) {
        clearInactiveWrapper.classList.remove("hidden");
        const clearBtn = document.createElement("button");
        clearBtn.className = "clear-inactive-btn";
        clearBtn.textContent = "Clear Inactive Alerts";
        clearBtn.addEventListener("click", showClearInactiveConfirmation);
        clearInactiveWrapper.appendChild(clearBtn);
      } else {
        clearInactiveWrapper.classList.add("hidden");
      }

      const order = { "Active": 0, "Expired": 1, "Cancelled": 2 };
      const sorted = [...list].sort((a, b) => {
        const sa = computeAlertStatus(a);
        const sb = computeAlertStatus(b);
        if (order[sa] !== order[sb]) return order[sa] - order[sb];
        return (b.setAt || 0) - (a.setAt || 0);
      });

      sorted.forEach(a => {
        const status = computeAlertStatus(a);
        const daysLeft = computeDaysLeft(a);

        const tr = document.createElement("tr");
        tr.dataset.alertId = a.id;

        if (status !== "Active") {
          tr.classList.add("inactive");
        }

        const tdDate = document.createElement("td");
        tdDate.textContent = formatDateShort(a.setAt);
        tr.appendChild(tdDate);

        const tdShoe = document.createElement("td");
        const shoeText = `${a.brand} ${a.model}`;
        tdShoe.textContent = shoeText.length > 30 ? shoeText.substring(0, 30) + '...' : shoeText;
        tdShoe.title = shoeText;
        tr.appendChild(tdShoe);

        const tdDays = document.createElement("td");
        tdDays.textContent = status === "Active" ? String(daysLeft) : "‚Äî";
        tr.appendChild(tdDays);

        const tdTarget = document.createElement("td");
        tdTarget.className = "target-cell";
        tdTarget.textContent = `$${Number(a.targetPrice).toFixed(0)}`;
        tr.appendChild(tdTarget);

        const tdStatus = document.createElement("td");
        const pill = document.createElement("span");
        pill.className = pillClassFor(status);
        pill.textContent = status;
        tdStatus.appendChild(pill);
        tr.appendChild(tdStatus);

        tr.addEventListener("click", (e) => {
          e.stopPropagation();

          const existingActionRow = document.querySelector(".alert-actions-row");
          if (existingActionRow) {
            existingActionRow.remove();
          }

          const allRows = alertsTbody.querySelectorAll("tr");
          allRows.forEach(r => r.classList.remove("selected"));

          if (selectedAlertRow === tr) {
            selectedAlertRow = null;
            return;
          }

          tr.classList.add("selected");
          selectedAlertRow = tr;

          const actionRow = document.createElement("tr");
          actionRow.className = "alert-actions-row";
          const actionCell = document.createElement("td");
          actionCell.colSpan = 5;

          const actionsDiv = document.createElement("div");
          actionsDiv.className = "alert-actions";

          if (status === "Active") {
            const priceWrapper = document.createElement("div");
            priceWrapper.className = "price-change-wrapper";

            const editLabel = document.createElement("span");
            editLabel.className = "edit-price-label";
            editLabel.textContent = "Edit Price:";
            priceWrapper.appendChild(editLabel);

            const priceInputWrapper = document.createElement("span");
            priceInputWrapper.className = "price-change-input";

            const priceInput = document.createElement("input");
            priceInput.type = "number";
            priceInput.step = "1";
            priceInput.min = "1";
            priceInput.value = Number(a.targetPrice).toFixed(0);

            priceInputWrapper.appendChild(priceInput);
            priceWrapper.appendChild(priceInputWrapper);

            const saveBtn = document.createElement("button");
            saveBtn.textContent = "Save";
            saveBtn.addEventListener("click", (e) => {
              e.stopPropagation();
              const val = Number(priceInput.value);
              if (!isFinite(val) || val <= 0) {
                alert("Please enter a valid target price greater than 0.");
                return;
              }
              showConfirmation(actionsDiv, "Save new price?", () => {
                a.targetPrice = Number(val).toFixed(2);
                a.setAt = nowMs();
                upsertAlert(a);
                renderAlertsDashboard();
              });
            });

            priceWrapper.appendChild(saveBtn);
            actionsDiv.appendChild(priceWrapper);

            const add10Btn = document.createElement("button");
            add10Btn.textContent = "Add 10 Days";
            add10Btn.className = "secondary";
            add10Btn.addEventListener("click", (e) => {
              e.stopPropagation();
              showConfirmation(actionsDiv, "Add 10 days to alert?", () => {
                const TEN_DAYS_MS = 10 * 24 * 60 * 60 * 1000;
                a.setAt = a.setAt - TEN_DAYS_MS;
                upsertAlert(a);
                renderAlertsDashboard();
              });
            });
            actionsDiv.appendChild(add10Btn);

            const cancelBtn = document.createElement("button");
            cancelBtn.textContent = "Cancel Alert";
            cancelBtn.className = "danger";
            cancelBtn.addEventListener("click", (e) => {
              e.stopPropagation();
              showConfirmation(actionsDiv, "Cancel this alert?", () => {
                a.cancelledAt = nowMs();
                upsertAlert(a);
                renderAlertsDashboard();
              });
            });
            actionsDiv.appendChild(cancelBtn);

          } else {
            const deleteBtn = document.createElement("button");
            deleteBtn.textContent = "Delete";
            deleteBtn.className = "danger";
            deleteBtn.addEventListener("click", (e) => {
              e.stopPropagation();
              showConfirmation(actionsDiv, "Delete this alert?", () => {
                deleteAlert(a.id);
                renderAlertsDashboard();
              });
            });
            actionsDiv.appendChild(deleteBtn);
          }

          actionCell.appendChild(actionsDiv);
          actionRow.appendChild(actionCell);
          tr.parentNode.insertBefore(actionRow, tr.nextSibling);
        });

        alertsTbody.appendChild(tr);
      });
    }

    document.addEventListener("click", (e) => {
      if (!e.target.closest(".alerts-table") && !e.target.closest(".alert-actions")) {
        const existingActionRow = document.querySelector(".alert-actions-row");
        if (existingActionRow) {
          existingActionRow.remove();
        }
        const allRows = alertsTbody.querySelectorAll("tr");
        allRows.forEach(r => r.classList.remove("selected"));
        selectedAlertRow = null;
      }
    });

    const brandModels = {
      "Asics": ["Novablast","Gel-Kayano","Gel-Nimbus","Gel-Cumulus","Metaspeed Sky"],
      "Nike": ["Pegasus","ZoomX Vaporfly","Alphafly","Infinity Run","Structure"],
      "Adidas": ["Adizero Adios","Adizero Boston","Adizero Takumi Sen","Supernova","Ultraboost Light"],
      "Brooks": ["Ghost","Glycerin","Adrenaline GTS","Launch","Hyperion"],
      "Saucony": ["Ride","Endorphin Speed","Endorphin Pro","Kinvara","Triumph","Guide"],
      "Hoka": ["Clifton","Bondi","Mach","Rincon","Arahi","Carbon X"],
      "New Balance": ["Fresh Foam 1080","FuelCell Rebel","Fresh Foam X 880","Fresh Foam More","RC Elite"],
      "On": ["Cloudsurfer","Cloudmonster","Cloudflow","Cloudstratus","Cloudboom Echo"],
      "Altra": ["Escalante","Torin","Lone Peak","Paradigm","Provision"],
      "Mizuno": ["Wave Rider","Wave Inspire","Wave Rebellion","Wave Sky"],
      "Puma": ["Deviate Nitro","Velocity Nitro","Magnify Nitro"],
      "Under Armour": ["HOVR Machina","HOVR Infinite","Charged Assert"],
      "Skechers": ["GOrun Ride","GOrun Razor","MaxRoad"],
      "Salomon": ["S/Lab Pulsar","Sense Ride","Ultra Glide"],
      "Topo Athletic": ["Ultrafly","Phantom","Fly Lite"],
      "Diadora": ["Mythos Blushield","Equilibrium","Elite Volo"],
      "Karhu": ["Fusion","Ikoni","Synchron"],
      "Reebok": ["Floatride Energy","Floatride Run Fast"]
    };

    const brands = Object.keys(brandModels).sort();

    function resolveBrandKey(input) {
      const normalized = normalizeStr(input);
      return brands.find(b => normalizeStr(b) === normalized) || "";
    }

    function resolveBrand() { return resolveBrandKey(brandInput.value.trim()); }

    function resolveModelKey(brandKey, modelTyped) {
      const typed = String(modelTyped || "").trim();
      if (!typed) return "";
      if (!brandKey || !brandModels[brandKey]) return typed;
      const normalized = normalizeStr(typed);
      const canonical = brandModels[brandKey].find(m => normalizeStr(m) === normalized);
      return canonical || typed;
    }

    function filterStartsWith(list, text) {
      if (!text) return [];
      const lower = text.toLowerCase();
      return list.filter(item => item.toLowerCase().startsWith(lower));
    }

    function showSuggestions(container, items, onClickItem) {
      container.innerHTML = "";
      if (!items.length) { container.style.display = "none"; return; }
      items.forEach(value => {
        const div = document.createElement("div");
        div.className = "suggestion-item";
        div.textContent = value;
        div.addEventListener("mousedown", (e) => {
          e.preventDefault();
          onClickItem(value);
        });
        container.appendChild(div);
      });
      container.style.display = "block";
    }

    function enableModel() {
      modelInput.disabled = false;
      modelInput.classList.remove("model-inactive");
      modelInput.classList.add("model-active");
    }

    function resetModelState() {
      modelInput.disabled = true;
      modelInput.value = "";
      modelInput.placeholder = "";
      modelInput.classList.remove("model-active");
      modelInput.classList.add("model-inactive");
      modelSuggestions.style.display = "none";
      modelPaw.classList.add("hidden");
      modelPaw.classList.remove("rock");
      brandSelected = false;
    }

    function confirmBrandSelection() {
      if (!modelInput.disabled) {
        modelInput.placeholder = "Enter Shoe Model";
        brandSelected = true;
        brandPaw.classList.add("hidden");
        brandPaw.classList.remove("rock");
        modelPaw.classList.remove("hidden");
        modelPaw.classList.add("rock");
      }
    }

    function updateFetchReady() {
      const brandKey = resolveBrand();
      const modelHasText = !!modelInput.value.trim();
      const ready = !!brandKey && !modelInput.disabled && modelHasText;
      fetchBtn.classList.toggle("ready", ready);
    }

    function updatePaws() {
      if (brandInput.value.trim()) {
        brandPaw.classList.add("hidden");
      } else if (!brandSelected) {
        brandPaw.classList.remove("hidden");
        brandPaw.classList.add("rock");
      }

      if (brandSelected && !modelInput.disabled) {
        if (!modelInput.value.trim()) {
          modelPaw.classList.remove("hidden");
          modelPaw.classList.add("rock");
        } else {
          modelPaw.classList.add("hidden");
          modelPaw.classList.remove("rock");
        }
      } else {
        modelPaw.classList.add("hidden");
        modelPaw.classList.remove("rock");
      }

      updateFetchReady();
    }

    function updateAlertSubmitButton() {
      const price = alertPriceInput.value.trim();
      const contact = alertContactInput.value.trim();
      const priceValid = price && parseFloat(price) > 0;
      const contactValid = contact.length > 0 && contact.includes('@');
      const isReady = priceValid && contactValid;
      alertSubmitBtn.classList.toggle("ready", isReady);
    }

    function resetAlertSection() {
      alertPromptBtn.style.display = "block";
      alertForm.style.display = "none";
      alertConfirmation.style.display = "none";
      alertExistingInfo.style.display = "none";
      alertPriceInput.value = "";
      alertContactInput.value = "";
      alertPricePaw.classList.remove("hidden");
      alertPricePaw.classList.add("rock");
      updateAlertSubmitButton();
    }

    function hideAllContentBelowStatus() {
      mainContent.classList.add("hidden");
      alertsDashboard.classList.add("hidden");
      resultsEl.innerHTML = "";
      dailyDeals.style.display = "none";
      alertWrapper.style.display = "none";
      resetAlertSection();
      statusMessageEl.textContent = "";
    }

function showHome() {
  alertsDashboard.classList.add("hidden");
  mainContent.classList.remove("hidden");
  resultsEl.innerHTML = "";              // Clear search results
  dailyDeals.style.display = "block";    // Always show daily deals
  statusMessageEl.textContent = "";      // Clear status message
  alertWrapper.style.display = "none";   // Hide alert section
}


    function showMyAlerts() {
      hideAllContentBelowStatus();
      alertsDashboard.classList.remove("hidden");
      renderAlertsDashboard();
    }

    myAlertsLink.addEventListener("click", showMyAlerts);
    logoLink.addEventListener("click", showHome);

    resetModelState();
    updatePaws();
    dailyDeals.style.display = "block";

brandInput.addEventListener("input", () => {
  const typed = brandInput.value.trim();
  if (typed) enableModel();
  else resetModelState();
  const matches = filterStartsWith(brands, typed);
  showSuggestions(brandSuggestions, matches, (value) => {
    brandInput.value = value;
    brandSuggestions.style.display = "none";
    enableModel();
    confirmBrandSelection();
    setTimeout(() => modelInput.focus(), 0);
    updatePaws();
  });
  updatePaws();
});



brandInput.addEventListener("blur", () => setTimeout(() => { brandSuggestions.style.display = "none"; }, 120));

brandInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    const typed = brandInput.value.trim();
    if (typed) {
      e.preventDefault();
      enableModel();
      confirmBrandSelection();
      modelInput.focus();
      updatePaws();
    }
  }
});

modelInput.addEventListener("input", () => {
  const brandKey = resolveBrand();
  const text = modelInput.value.trim();
  if (!brandKey || !brandModels[brandKey]) {
    modelSuggestions.style.display = "none";
    updatePaws();
    return;
  }
  const models = brandModels[brandKey];
  const matches = filterStartsWith(models, text);
  showSuggestions(modelSuggestions, matches, (value) => {
    modelInput.value = value;
    modelSuggestions.style.display = "none";
    setTimeout(() => fetchBtn.focus(), 0);
    updatePaws();
  });
  updatePaws();
});

brandInput.addEventListener("click", () => {
  brandInput.select();
});

modelInput.addEventListener("click", () => {
  modelInput.select();
});
    modelInput.addEventListener("blur", () => setTimeout(() => { modelSuggestions.style.display = "none"; }, 120));

    alertPriceInput.addEventListener("input", () => {
      if (alertPriceInput.value.trim()) {
        alertPricePaw.classList.add("hidden");
      } else {
        alertPricePaw.classList.remove("hidden");
        alertPricePaw.classList.add("rock");
      }
      updateAlertSubmitButton();
    });

    alertContactInput.addEventListener("input", updateAlertSubmitButton);

    function formatPriceValue(value) {
      const num = Number(value);
      if (Number.isFinite(num)) return `$${num.toFixed(2)}`;
      if (typeof value === "string") return value;
      return "‚Äî";
    }

    // Helper: create unified deal card (used for search + daily deals)
        function createDealCard(item) {
      const discount = getDiscountInfo(item); // uses price + originalPrice

      const card = document.createElement("div");
      card.className = "card";

      const link = document.createElement("a");
      link.className = "card-link";
      link.href = item.url || "#";
      link.target = "_blank";
      link.rel = "noopener noreferrer";

      // --- image + corner badge ---
      const imgWrapper = document.createElement("div");
      imgWrapper.className = "card-image-wrapper";

      if (item.image) {
        const img = document.createElement("img");
        img.src = item.image;
        img.alt = item.title || "Running shoe deal";
        imgWrapper.appendChild(img);
      } else {
        // keep your existing behavior if you prefer, or leave empty
        const img = document.createElement("img");
        img.alt = "Running shoe";
        imgWrapper.appendChild(img);
      }

      if (discount.hasDiscount) {
        const badge = document.createElement("div");
        badge.className = "discount-badge";
        badge.textContent = `${discount.percent}% OFF`;
        imgWrapper.appendChild(badge);
      }

      link.appendChild(imgWrapper);

      // --- title & store ---
      const titleDiv = document.createElement("div");
      titleDiv.className = "card-title";
      titleDiv.textContent = item.title || "Deal";
      link.appendChild(titleDiv);

      if (item.store) {
        const storeDiv = document.createElement("div");
        storeDiv.className = "card-store";
        storeDiv.textContent = item.store;
        link.appendChild(storeDiv);
      }

      // --- price row (current + struck-through original) ---
      const priceRow = document.createElement("div");
      priceRow.className = "card-price-row";

      const priceSpan = document.createElement("span");
      priceSpan.className = "price";

      const currentPrice = Number(item.price);
      if (Number.isFinite(currentPrice)) {
        priceSpan.textContent = `$${currentPrice.toFixed(2)}`;
      } else {
        priceSpan.textContent = item.price ? String(item.price) : "‚Äî";
      }
      priceRow.appendChild(priceSpan);

      if (discount.hasDiscount) {
        const origSpan = document.createElement("span");
        origSpan.className = "card-original-price";
        origSpan.textContent = `$${discount.original}`;
        priceRow.appendChild(origSpan);
      }

      link.appendChild(priceRow);

      card.appendChild(link);
      return card;
    }


    // Load daily deals from API and render as cards
    async function loadDailyDeals() {
      try {
        const res = await fetch("/api/daily-deals");
        const data = await res.json();
        const deals = (data && Array.isArray(data.deals)) ? data.deals : [];
        dailyDealsGrid.innerHTML = "";

        if (!deals.length) {
          dailyDeals.style.display = "none";
          return;
        }

        deals.forEach(item => {
          const card = createDealCard(item);
          dailyDealsGrid.appendChild(card);
        });

        dailyDeals.style.display = "block";
      } catch (err) {
        console.error("Error loading daily deals:", err);
        dailyDeals.style.display = "none";
      }
    }

    // Initial daily deals load
    loadDailyDeals();

    form.addEventListener("submit", async (e) => {
  e.preventDefault();
  
  // Get whatever the user typed - no validation required
  const brandTyped = brandInput.value.trim();
  const modelTyped = modelInput.value.trim();
  
  if (!brandTyped || !modelTyped) {
    statusMessageEl.textContent = "Please enter both brand and model.";
    updatePaws();
    return;
  }
  
  currentSearch = { brand: brandTyped, model: modelTyped };
  
  statusMessageEl.textContent = "Searching deals‚Ä¶";
  resultsEl.innerHTML = "";
  dailyDeals.style.display = "none";
  
  resetAlertSection();
  alertWrapper.style.display = "flex";
  
  const existingActive = findActiveAlertFor(brandTyped, modelTyped);
  if (existingActive) {
    alertPromptBtn.style.display = "none";
    const daysLeft = computeDaysLeft(existingActive);
    alertExistingInfo.innerHTML = `
      <strong>You have an active alert set for this shoe.</strong><br><br>
      <strong>Shoe:</strong> ${existingActive.brand} ${existingActive.model}<br>
      <strong>Days Remaining:</strong> ${daysLeft}<br>
      <strong>Target Price:</strong> $${Number(existingActive.targetPrice).toFixed(2)}<br><br>
      Open <strong>My Alerts</strong> to manage it.
    `;
    alertExistingInfo.style.display = "block";
  } else {
    alertPromptBtn.style.display = "block";
    alertExistingInfo.style.display = "none";
  }
  
  alertProductName.textContent = `${brandTyped} ${modelTyped}`;
  
  const query = `${brandTyped} ${modelTyped}`;
  let data;
  
  try {
    const res = await fetch("/api/search?" + new URLSearchParams({ query }));
    data = await res.json();
  } catch (err) {
    console.error("Search error:", err);
    statusMessageEl.textContent = "Search failed. Please try again.";
    return;
  }
  
  const results = (data && data.results) ? data.results : [];
  
  if (!results.length) {
    statusMessageEl.textContent = `No results found for ${brandTyped} ${modelTyped} ‚Äî set a price alert and we'll keep sniffing.`;
    return;
  }
  
statusMessageEl.textContent = `Top ${results.length} deal${results.length === 1 ? '' : 's'} found for ${brandTyped} ${modelTyped}`;
      resultsEl.innerHTML = "";
  
  results.forEach(item => {
    const card = createDealCard(item);
    resultsEl.appendChild(card);
  });
});

    alertPromptBtn.addEventListener("click", () => {
      alertPromptBtn.style.display = "none";
      alertForm.style.display = "flex";
      alertProductName.textContent = `${currentSearch.brand} ${currentSearch.model}`;
    });

    alertSubmitBtn.addEventListener("click", async () => {
      const priceNum = Number(alertPriceInput.value.trim());
      const contact = alertContactInput.value.trim();
      const brand = currentSearch.brand;
      const model = currentSearch.model;

      if (!brand || !model) {
        alert("Please search for a shoe first, then set an alert.");
        return;
      }

      if (!isFinite(priceNum) || priceNum <= 0) {
        alert("Please enter a valid target price greater than 0.");
        return;
      }

      const existingActive = findActiveAlertFor(brand, model);
      if (existingActive) {
        alertForm.style.display = "none";
        alertConfirmation.innerHTML = `
          <strong>This shoe already has an active alert.</strong><br><br>
          To edit the alert, please manage it in <strong>My Alerts</strong>.
        `;
        alertConfirmation.style.display = "block";
        return;
      }

      const isEmail = contact.includes('@');
      const payload = {
        product: `${brand} ${model}`,
        targetPrice: Number(priceNum).toFixed(2),
        email: isEmail ? contact : "",
        phone: isEmail ? "" : contact
      };

      const newAlert = {
        id: `a_${Math.random().toString(36).slice(2)}_${Date.now()}`,
        key: alertKey(brand, model),
        setAt: nowMs(),
        brand,
        model,
        targetPrice: Number(priceNum).toFixed(2),
        cancelledAt: null,
        contact
      };
      upsertAlert(newAlert);

      try {
        await fetch("/api/alerts", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        alertForm.style.display = "none";
        alertConfirmation.innerHTML = `
          <strong>Price alert set!</strong><br><br>
          We'll notify you at <strong>${contact}</strong> when <strong>${brand} ${model}</strong> drops below <strong>$${Number(priceNum).toFixed(2)}</strong>.
        `;
        alertConfirmation.style.display = "block";
      } catch (err) {
        console.error("Alert submission error:", err);
        alert("Failed to set alert. Please try again.");
      }
    });

    alertPriceInput.addEventListener("input", () => {
      if (alertPriceInput.value.trim()) {
        alertPricePaw.classList.add("hidden");
      } else {
        alertPricePaw.classList.remove("hidden");
        alertPricePaw.classList.add("rock");
      }
      updateAlertSubmitButton();
    });

    alertContactInput.addEventListener("input", updateAlertSubmitButton);
        // Contact form submission
    if (contactForm) {
      contactForm.addEventListener("submit", async (e) => {
        // ... all the form handler code ...
      });
    }

    function showContactStatus(message, type) {
      // ... all the status function code ...
    }  </script>
</body>
</html>
